<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Inline Web Worker</title>

    <script src="../src/worker-thread.js"></script>
  </head>
  <body>

    <script type="text/javascript">

    window.onload = function () {

       // Examples of 'run' method

      WorkerThread.run(function () {
        return 1 + 2;
      }).then(function (e) {
        console.log("1.","worker message:", e.data);
      });

      WorkerThread.run(function (a, b) {
        return a + b;
      }, 1, 2).then(function (e) {
        console.log("2.", "worker message:", e.data);
      });

      var task = WorkerThread.run(function (a, b, c) {
        return "" + a + b + c;
      }, 1, "a", "1+2*8");
      task.then(function (e) {
        console.log("3.", "worker message:", e.data);
      });


      // Examples of 'await' method

      var workerOk = WorkerThread.await(function (e) {
        return "ok: " + e.data;
      });
      workerOk.onmessage = function (e) {
        console.log("4.", "workerOk message:", e.data);
      }
      workerOk.postMessage("hello");
      workerOk.postMessage("world");

      var workerMinMax = WorkerThread.await(function (e, min, max) {
        return Math.min(Math.max(e.data, min), max);
      }, 0, 1);
      workerMinMax.onmessage = function (e) {
        console.log("5.", "workerMinMax message:", e.data);
      }
      workerMinMax.postMessage(0.5);
      workerMinMax.postMessage(1.2);


      // Examples of 'new' method

      var countWorker = WorkerThread.new(function (name, count) {
        self.name = name;
        self.onmessage = function (e) {
          count++;
          postMessage("" + self.name + ", count = " + count);
        }
      }, "'Worker Name'", 0);
      countWorker.onmessage = function (e) {
        console.log("6.", "countWorker message:", e.data);
      }
      countWorker.postMessage();
      countWorker.postMessage();

      function add(a, b) {
        return a + (a.length ? ", " : "") + b;
      }
      var composedWorker = WorkerThread.new(function (add) {
        self.onmessage = function (e) {
          var array = e.data;
          var string = "";
          for (var i = 0; i < array.length; i++) {
            string = add(string, array[i]);
          }
          postMessage(string);
        }
      }, add);
      composedWorker.onmessage = function (e) {
        console.log("7.", "composedWorker message:", e.data);
      }
      composedWorker.postMessage([1, 2]);
      composedWorker.postMessage(["a", "b", "c"]);


      // Example of non-blocking operation with a thread

      var longWorker = WorkerThread.run(function () {
        var values = new Array(1<<24);
        for (var i = 0; i < values.length; i++) {
          values[i] = i << 24;
        }
        return values;
      }).then(function (e) {
        console.log("8.", "longWorker message:", e.data.length);
      });
    }
    </script>

  </body>
</html>
